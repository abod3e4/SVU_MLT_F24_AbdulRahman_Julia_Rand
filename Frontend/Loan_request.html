<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Loan Request - TrustBank</title>
		<link rel="stylesheet" href="Loan_request.css" />
		<link
			href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap"
			rel="stylesheet"
		/>
		<!-- إضافة مكتبة jQuery من CDN -->
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	</head>
	<body>
		<!-- Header -->
		<header>
			<div class="logo">TrustBank</div>
			<p class="tagline">’’Your Financial Partner’’</p>
		</header>

		<!-- Navbar -->
		<nav>
			<ul>
				<li><a href="index.html">Home</a></li>
				<li><a href="#">Services</a></li>
				<li><a href="#">About Us</a></li>
				<li><a href="#">Contact</a></li>
			</ul>
		</nav>

		<!-- Main Section -->
		<main>
			<section class="loan-request">
				<h2>Loan Request Form</h2>
				<p>Please fill in the form below to request a loan:</p>
				<div id="result"></div>
				<form action="#" method="POST" class="loan-form">
					<div class="form-group">
						<label for="gender">Gender</label>
						<select id="gender" name="Gender" required>
							<option value="">Select</option>
							<option value="Male">Male</option>
							<option value="Female">Female</option>
						</select>
					</div>

					<div class="form-group">
						<label for="married">Married</label>
						<select id="married" name="Married" required>
							<option value="">Select</option>
							<option value="Yes">Yes</option>
							<option value="No">No</option>
						</select>
					</div>

					<div class="form-group">
						<label for="dependents">Dependents</label>
						<select id="dependents" name="Dependents" required>
							<option value="">Select</option>
							<option value="0">0</option>
							<option value="1">1</option>
							<option value="2">2</option>
							<option value="3+">3+</option>
						</select>
					</div>

					<div class="form-group">
						<label for="education">Education</label>
						<select id="education" name="Education" required>
							<option value="">Select</option>
							<option value="Graduate">Graduate</option>
							<option value="Not Graduate">Not Graduate</option>
						</select>
					</div>

					<div class="form-group">
						<label for="self_employed">Self Employed</label>
						<select id="self_employed" name="Self_Employed" required>
							<option value="">Select</option>
							<option value="Yes">Yes</option>
							<option value="No">No</option>
						</select>
					</div>

					<div class="form-group">
						<label for="applicant_income">Applicant Income</label>
						<input
							type="number"
							id="applicant_income"
							name="ApplicantIncome"
							required
						/>
					</div>

					<div class="form-group">
						<label for="coapplicant_income">Coapplicant Income</label>
						<input
							type="number"
							id="coapplicant_income"
							name="CoapplicantIncome"
							required
						/>
					</div>

					<div class="form-group">
						<label for="loan_amount">Loan Amount</label>
						<input type="number" id="loan_amount" name="LoanAmount" required />
					</div>

					<div class="form-group">
						<label for="loan_term">Loan Term (months)</label>
						<select id="loan_term" name="Loan_Amount_Term" required>
							<option value="">Select</option>
							<option value="12">12</option>
							<option value="36">36</option>
							<option value="60">60</option>
							<option value="84">84</option>
							<option value="120">120</option>
							<option value="180">180</option>
							<option value="240">240</option>
							<option value="300">300</option>
							<option value="360">360</option>
						</select>
					</div>

					<div class="form-group">
						<label for="credit_history">Credit History</label>
						<select id="credit_history" name="Credit_History" required>
							<option value="">Select</option>
							<option value="1">Good (1)</option>
							<option value="0">Bad (0)</option>
						</select>
					</div>

					<div class="form-group">
						<label for="property_area">Property Area</label>
						<select id="property_area" name="Property_Area" required>
							<option value="">Select</option>
							<option value="Urban">Urban</option>
							<option value="Semiurban">Semiurban</option>
							<option value="Rural">Rural</option>
						</select>
					</div>
					<button type="button" class="btn-predict">Predict</button>
					<button type="submit" class="btn-submit">Submit</button>
				</form>
			</section>
		</main>
		<footer>
			<div class="footer-container">
				<div class="footer-brand">
					<h2>TrustBank</h2>
					<p>Your trusted financial partner.</p>
				</div>
				<div class="footer-contact">
					<h3>Contact Us</h3>
					<p>Email: info@trustbank.com</p>
					<p>Phone: +963-800-TRUSTBANK</p>
				</div>

				<div class="footer-links">
					<h3>Quick Links</h3>
					<ul>
						<li><a href="index.html">Home</a></li>
						<li><a href="#">Services</a></li>
						<li><a href="#">About</a></li>
						<li><a href="#">Contact</a></li>
					</ul>
				</div>
			</div>

			<div class="footer-bottom">
				<p>&copy; 2025 TrustBank. All rights reserved.</p>
			</div>
		</footer>
		<script>
			$(document).ready(function () {
				$(".btn-predict").on("click", function () {
					// جمع البيانات من المدخلات في النموذج
					var formData = {
						Gender: $("#gender").val(), // جمع البيانات من المدخلات
						Married: $("#married").val(),
						Dependents: $("#dependents").val(),
						Education: $("#education").val(),
						Self_Employed: $("#self_employed").val(),
						ApplicantIncome: $("#applicant_income").val(),
						CoapplicantIncome: $("#coapplicant_income").val(),
						LoanAmount: $("#loan_amount").val(),
						Loan_Amount_Term: $("#loan_term").val(),
						Credit_History: $("#credit_history").val(),
						Property_Area: $("#property_area").val(),
					};

					// التأكد من أن جميع الحقول تم تعبئتها (يمكنك إضافة تحقق إضافي هنا إذا كنت ترغب)
					if (!Object.values(formData).every((value) => value !== "")) {
						$("#result").html(
							'<p style="color: red;">Please fill out all fields.</p>'
						);
						return;
					}

					// إرسال طلب POST إلى الـ API
					$.ajax({
						url: "https://mlt.vilmo.app/predict", // API endpoint
						type: "POST",
						contentType: "application/json", // Ensure JSON format
						data: JSON.stringify(formData), // Convert formData to JSON string
						success: function (response) {
							// Check if response has the expected properties
							if (response && response.prediction !== undefined) {
								const resultText =
									response.prediction === "1" ? "Approved" : "Rejected";
								const probability = response.approval_probability || 0;

								$("#result").html(
									`<p>Prediction Result: <strong>${resultText}</strong></p>
									<p>Approval Probability: <strong>${probability}%</strong></p>`
								);
							} else {
								$("#result").html("<p>Unable to get prediction result.</p>");
							}
						},
						error: function (xhr, status, error) {
							console.log("Error details:", xhr, status, error);
							$("#result").html(
								'<p style="color: red;">Error occurred while making prediction. Please try again later.</p>'
							);
						},
					});
				});
			});

			document
				.querySelector(".loan-form")
				.addEventListener("submit", async function (e) {
					e.preventDefault(); // منع إعادة تحميل الصفحة

					// تجميع البيانات من النموذج
					const formData = new FormData(this);
					const data = {};

					// تحويل البيانات إلى كائن JSON
					formData.forEach((value, key) => {
						data[key] = value;
					});

					try {
						// إرسال البيانات إلى endpoint /add-request
						const response = await fetch("https://mlt.vilmo.app/add-request", {
							method: "POST",
							headers: {
								"Content-Type": "application/json",
							},
							body: JSON.stringify(data),
						});

						if (!response.ok) {
							throw new Error("فشل في إرسال طلب القرض");
						}

						//الاستجابة
						const result = await response.json();
						alert("✅ تم إرسال طلب القرض بنجاح!");

						// إعادة تعيين النموذج بعد الإرسال
						this.reset();
					} catch (error) {
						alert("❌ حدث خطأ أثناء إرسال الطلب: " + error.message);
					}
				});
		</script>
	</body>
</html>
